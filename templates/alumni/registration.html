{% extends 'shared/base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Register as MSU Alumni{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
<style>
    /* MSU Color Scheme */
    :root {
        --msu-blue: #1e88e5;
        --msu-blue-dark: #1565c0;
        --msu-yellow: #ffd600;
    }
    
    .form-card {
        background: white;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--msu-blue);
        overflow: hidden;
        position: relative;
    }
    
    .form-header {
        background-color: #f8f9fa;
        padding: 0.75rem;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .form-body {
        padding: 1.5rem;
    }
    
    .form-section {
        margin-bottom: 1rem;
    }
    
    .section-title {
        color: var(--msu-blue);
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .form-input, .form-select, .form-textarea {
        width: 100%;
        padding: 0.5rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        transition: all 0.2s;
    }
    
    .form-input:focus, .form-select:focus, .form-textarea:focus {
        outline: none;
        border-color: var(--msu-blue);
        box-shadow: 0 0 0 2px rgba(30, 136, 229, 0.2);
    }
    
    .btn-primary {
        background-color: var(--msu-blue);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.375rem;
        font-weight: 500;
        width: 100%;
        transition: background-color 0.2s;
    }
    
    .btn-primary:hover {
        background-color: var(--msu-blue-dark);
    }
    
    .error-message {
        color: #ef4444;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    
    .info-card {
        background: white;
        padding: 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        border: 1px solid #e2e8f0;
    }
    
    .info-card h3 {
        color: #1f2937;
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }
    
    .required-field::after {
        content: '*';
        color: #ef4444;
        margin-left: 0.25rem;
    }
    
    /* Employment section specific styles */
    .employment-detail {
        transition: all 0.3s ease-in-out;
    }
    
    .employment-detail.show {
        display: block !important;
        opacity: 1;
        transform: translateY(0);
    }
    
    .employment-detail.hide {
        display: none !important;
        opacity: 0;
        transform: translateY(-10px);
    }
    
    #employment-other-container {
        transition: all 0.3s ease-in-out;
    }
    
    /* Responsive adjustments */
    @media (min-width: 1024px) {
        .form-container {
            max-width: 1280px;
            margin-left: auto;
            margin-right: auto;
        }
    }
</style>
<style>
    .form-input, .form-select, .form-textarea {
        @apply w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-msu-blue focus:border-msu-blue transition duration-200;
    }
    .form-checkbox {
        @apply h-4 w-4 text-msu-blue focus:ring-msu-blue border-gray-300 rounded;
    }
    .error-message {
        @apply text-red-500 text-sm mt-1;
    }
    .required-field::after {
        content: ' *';
        @apply text-red-500;
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-gray-50 py-2">
    <div class="container mx-auto px-4 max-w-7xl">
        {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
            <div class="p-3 rounded-lg text-sm {% if message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}" role="alert">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Left Column - Registration Form -->
            <div class="lg:w-2/3">
                <div class="form-card">
                    <div class="form-header">
                        <h2 class="text-xl font-semibold text-gray-800">Create Your Account</h2>
                    </div>
                    <div class="form-body">
                        <form method="post" enctype="multipart/form-data" class="space-y-8">
                            {% csrf_token %}
                            
                            <!-- Personal Information Section -->
                            <div class="form-section">
                                <h3 class="section-title">Personal Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Salutation -->
                                    <div>
                                        <label for="{{ form.salutation.id_for_label }}" class="block text-gray-700 font-medium mb-2 required-field">Salutation</label>
                                        <div class="relative">
                                            <select name="{{ form.salutation.name }}"
                                                    id="{{ form.salutation.id_for_label }}"
                                                    class="form-select appearance-none {% if form.salutation.errors %}border-red-500{% endif %}">
                                                <option value="">Select</option>
                                                {% for value, label in form.salutation.field.choices %}
                                                <option value="{{ value }}" {% if form.salutation.value == value %}selected{% endif %}>{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        {% if form.salutation.errors %}
                                        <p class="error-message">{{ form.salutation.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    <!-- First Name -->
                                    <div>
                                        <label for="{{ form.first_name.id_for_label }}" class="block text-gray-700 font-medium mb-2 required-field">Surname</label>
                                        <div class="relative">
                                            <input type="text" 
                                                   name="{{ form.first_name.name }}" 
                                                   id="{{ form.first_name.id_for_label }}" 
                                                   value="{{ form.first_name.value|default:'' }}" 
                                                   class="form-input {% if form.first_name.errors %}border-red-500{% endif %}"
                                                   autocomplete="family-name"
                                                   required>
                                        </div>
                                        {% if form.first_name.errors %}
                                        <p class="error-message">{{ form.first_name.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Last Name -->
                                    <div>
                                        <label for="{{ form.last_name.id_for_label }}" class="block text-gray-700 font-medium mb-2 required-field">First Names</label>
                                        <div class="relative">
                                            <input type="text" 
                                                   name="{{ form.last_name.name }}" 
                                                   id="{{ form.last_name.id_for_label }}" 
                                                   value="{{ form.last_name.value|default:'' }}" 
                                                   class="form-input {% if form.last_name.errors %}border-red-500{% endif %}"
                                                   autocomplete="given-name"
                                                   required>
                                        </div>
                                        {% if form.last_name.errors %}
                                        <p class="error-message">{{ form.last_name.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Gender -->
                                    <div>
                                        <label for="{{ form.gender.id_for_label }}" class="block text-gray-700 font-medium mb-2 required-field">Gender</label>
                                        <div class="relative">
                                            <select name="{{ form.gender.name }}" 
                                                    id="{{ form.gender.id_for_label }}" 
                                                    class="form-select appearance-none {% if form.gender.errors %}border-red-500{% endif %}">
                                                <option value="">Select Gender</option>
                                                {% for value, label in form.gender.field.choices %}
                                                <option value="{{ value }}" {% if form.gender.value == value %}selected{% endif %}>{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        {% if form.gender.errors %}
                                        <p class="error-message">{{ form.gender.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Maiden Name -->
                                    <div id="maiden-name-container" style="display: none;">
                                        <label for="{{ form.maiden_name.id_for_label }}" class="block text-gray-700 font-medium mb-2">Maiden Name</label>
                                        <div class="relative">
                                            <input type="text" 
                                                   name="{{ form.maiden_name.name }}" 
                                                   id="{{ form.maiden_name.id_for_label }}" 
                                                   value="{{ form.maiden_name.value|default:'' }}" 
                                                   class="form-input {% if form.maiden_name.errors %}border-red-500{% endif %}"
                                                   placeholder="Enter your maiden name">
                                        </div>
                                        {% if form.maiden_name.errors %}
                                        <p class="error-message">{{ form.maiden_name.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Date of Birth -->
                                    <div>
                                        <label for="{{ form.date_of_birth.id_for_label }}" class="block text-gray-700 font-medium mb-2 required-field">Date of Birth</label>
                                        <div class="relative">
                                            <input type="date" 
                                                   name="{{ form.date_of_birth.name }}" 
                                                   id="{{ form.date_of_birth.id_for_label }}" 
                                                   value="{{ form.date_of_birth.value|default:'' }}" 
                                                   class="form-input {% if form.date_of_birth.errors %}border-red-500{% endif %}" 
                                                   autocomplete="bday"
                                                   max="{{ today|default:'' }}">
                                        </div>
                                        {% if form.date_of_birth.errors %}
                                        <p class="error-message">{{ form.date_of_birth.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- National ID -->
                                    <div>
                                        <label for="{{ form.national_id.id_for_label }}" class="block text-gray-700 font-medium mb-2 required-field">National ID / Passport Number</label>
                                        <input type="text"
                                               name="{{ form.national_id.name }}"
                                               id="{{ form.national_id.id_for_label }}"
                                               value="{{ form.national_id.value|default:'' }}"
                                               class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-msu-blue focus:border-msu-blue transition duration-200"
                                               autocomplete="off"
                                               placeholder="e.g. 63-1234567X12"
                                               required>
                                        <p class="text-xs text-gray-500 mt-1">{{ form.national_id.help_text }}</p>
                                        {% if form.national_id.errors %}
                                        <p class="text-red-500 text-sm mt-1">{{ form.national_id.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Contact Information Section -->
                            <div class="form-section">
                                <h3 class="section-title">Contact Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Email Address -->
                                    <div>
                                        <label for="{{ form.email.id_for_label }}" class="block text-gray-700 font-medium mb-2 required-field">Email Address</label>
                                        <div class="relative">
                                            <input type="email" 
                                                   name="{{ form.email.name }}" 
                                                   id="{{ form.email.id_for_label }}" 
                                                   value="{{ form.email.value|default:'' }}" 
                                                   class="form-input {% if form.email.errors %}border-red-500{% endif %}"
                                                   autocomplete="email"
                                                   required>
                                        </div>
                                        {% if form.email.errors %}
                                        <p class="error-message">{{ form.email.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Phone Number -->
                                    <div>
                                        <label class="block text-gray-700 font-medium mb-2 required-field" for="{{ form.mobile_number.id_for_label }}">Phone Number</label>
                                        <input type="tel"
                                               name="{{ form.mobile_number.name }}"
                                               id="{{ form.mobile_number.id_for_label }}"
                                               value="{{ form.mobile_number.value|default:'' }}"
                                               class="w-full form-input {% if form.mobile_number.errors %}border-red-500{% endif %}"
                                               autocomplete="tel"
                                               placeholder="+263771234567" required>
                                        {% if form.mobile_number.errors %}
                                        <p class="error-message">{{ form.mobile_number.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Country -->
                                    <div>
                                        <label for="country" class="block text-gray-700 font-medium mb-2 required-field">Country</label>
                                        <div class="relative">
                                            <select name="country" 
                                                     id="country" 
                                                     class="form-select appearance-none js-example-basic-single"
                                                     autocomplete="country"
                                                     data-selected="{{ form.country.value }}"
                                                     required>
                                                <option value="">Select Country</option>
                                                {% for country in countries %}
                                                <option value="{{ country.code }}" {% if form.country.value == country.code %}selected{% endif %}>{{ country.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- City/Town -->
                                    <div>
                                        <label for="{{ form.city.id_for_label }}" class="block text-gray-700 font-medium mb-2">City/Town</label>
                                        <div class="relative">
                                            <input type="text" 
                                                   name="{{ form.city.name }}" 
                                                   id="{{ form.city.id_for_label }}" 
                                                   value="{{ form.city.value|default:'' }}" 
                                                   class="form-input {% if form.city.errors %}border-red-500{% endif %}"
                                                   autocomplete="address-level2"
                                                   placeholder="Enter your city or town">
                                        </div>
                                        {% if form.city.errors %}
                                        <p class="error-message">{{ form.city.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Academic Information Section -->
                            <div class="form-section">
                                <h3 class="section-title">Academic Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Registration Number -->
                                    <div>
                                        <label for="{{ form.reg_number.id_for_label }}" class="block text-gray-700 font-medium mb-2">Registration Number</label>
                                        <div class="relative">
                                            <input type="text" 
                                                   name="{{ form.reg_number.name }}" 
                                                   id="{{ form.reg_number.id_for_label }}" 
                                                   value="{{ form.reg_number.value|default:'' }}"
                                                   class="form-input {% if form.reg_number.errors %}border-red-500{% endif %}"
                                                   placeholder="e.g. R123456X">
                                        </div>
                                        {% if form.reg_number.errors %}
                                        <p class="error-message">{{ form.reg_number.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Programme Studied -->
                                    <div>
                                        <label for="{{ form.programme_studied.id_for_label }}" class="block text-gray-700 font-medium mb-2 required-field">Programme Studied</label>
                                        <div class="relative">
                                            <input type="text"
                                                   name="{{ form.programme_studied.name }}"
                                                   id="{{ form.programme_studied.id_for_label }}"
                                                   value="{{ form.programme_studied.value|default:'' }}"
                                                   class="form-input {% if form.programme_studied.errors %}border-red-500{% endif %}"
                                                   placeholder="e.g. BSc Computer Science"
                                                   required>
                                        </div>
                                        {% if form.programme_studied.errors %}
                                        <p class="error-message">{{ form.programme_studied.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Graduation Year -->
                                    <div>
                                        <label for="{{ form.graduation_year.id_for_label }}" class="block text-gray-700 font-medium mb-2">Graduation Year</label>
                                        <div class="relative">
                                            <select name="{{ form.graduation_year.name }}" 
                                                     id="{{ form.graduation_year.id_for_label }}" 
                                                     data-selected="{{ form.graduation_year.value }}"
                                                     class="form-select appearance-none {% if form.graduation_year.errors %}border-red-500{% endif %}">
                                                <option value="">Select Year</option>
                                                {% for year in year_choices %}
                                                <option value="{{ year }}" {% if form.graduation_year.value == year|stringformat:"s" %}selected{% endif %}>{{ year }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        {% if form.graduation_year.errors %}
                                        <p class="error-message">{{ form.graduation_year.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Degree Level -->
                                    <div>
                                        <label for="degree_level" class="block text-gray-700 font-medium mb-2">Highest Degree Level</label>
                                        <div class="relative">
                                            <select name="degree_level" 
                                                    id="degree_level" 
                                                    class="form-select appearance-none {% if form.degree_level.errors %}border-red-500{% endif %}">
                                                <option value="">Select Degree Level</option>
                                                {% for value, label in form.degree_level.field.choices %}
                                                <option value="{{ value }}" {% if form.degree_level.value == value %}selected{% endif %}>{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        {% if form.degree_level.errors %}
                                        <p class="error-message">{{ form.degree_level.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Other MSU Programs -->
                                    <div class="md:col-span-2">
                                        <label for="{{ form.other_programs.id_for_label }}" class="block text-gray-700 font-medium mb-2">Other MSU Programs (optional)</label>
                                        <div class="relative">
                                            <textarea 
                                                name="{{ form.other_programs.name }}" 
                                                id="{{ form.other_programs.id_for_label }}" 
                                                class="form-input {% if form.other_programs.errors %}border-red-500{% endif %}"
                                                rows="3"
                                                placeholder="e.g., Postgraduate Diploma in..., Short Course in..., Second Degree in...">{{ form.other_programs.value|default:'' }}</textarea>
                                        </div>
                                        {% if form.other_programs.errors %}
                                        <p class="error-message">{{ form.other_programs.errors.0 }}</p>
                                        {% endif %}
                                        <p class="text-xs text-gray-500 mt-1">List any additional programs you obtained from MSU (separate with commas).</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Employment Information Section -->
                            <div class="form-section">
                                <h3 class="section-title">Employment Information</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Employment Status -->
                                    <div>
                                        <label for="{{ form.employment_status.id_for_label }}" class="block text-gray-700 font-medium mb-2 required-field">Employment Status</label>
                                        <div class="relative">
                                            <select name="{{ form.employment_status.name }}" 
                                                    id="{{ form.employment_status.id_for_label }}" 
                                                    class="form-select appearance-none {% if form.employment_status.errors %}border-red-500{% endif %}">
                                                <option value="">Select Status</option>
                                                {% for value, label in form.employment_status.field.choices %}
                                                <option value="{{ value }}" {% if form.employment_status.value == value %}selected{% endif %}>{{ label }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        {% if form.employment_status.errors %}
                                        <p class="error-message">{{ form.employment_status.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Name of Organisation -->
                                    <div class="employment-detail" style="display: none;">
                                        <label for="{{ form.current_employer.id_for_label }}" class="block text-gray-700 font-medium mb-2">Name of Organisation</label>
                                        <div class="relative">
                                            <input type="text"
                                                   name="{{ form.current_employer.name }}"
                                                   id="{{ form.current_employer.id_for_label }}"
                                                   value="{{ form.current_employer.value|default:'' }}"
                                                   class="form-input {% if form.current_employer.errors %}border-red-500{% endif %}"
                                                   autocomplete="organization"
                                                   placeholder="Name of Organisation">
                                        </div>
                                        {% if form.current_employer.errors %}
                                        <p class="error-message">{{ form.current_employer.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Designation -->
                                    <div class="employment-detail" style="display: none;">
                                        <label for="{{ form.job_title.id_for_label }}" class="block text-gray-700 font-medium mb-2">Designation</label>
                                        <div class="relative">
                                            <input type="text"
                                                   name="{{ form.job_title.name }}"
                                                   id="{{ form.job_title.id_for_label }}"
                                                   value="{{ form.job_title.value|default:'' }}"
                                                   class="form-input {% if form.job_title.errors %}border-red-500{% endif %}"
                                                   autocomplete="organization-title"
                                                   placeholder="Your job title or designation">
                                        </div>
                                        {% if form.job_title.errors %}
                                        <p class="error-message">{{ form.job_title.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Industry -->
                                    <div class="employment-detail" style="display: none;">
                                        <label for="{{ form.industry.id_for_label }}" class="block text-gray-700 font-medium mb-2">Industry</label>
                                        <div class="relative">
                                            <input type="text"
                                                   name="{{ form.industry.name }}"
                                                   id="{{ form.industry.id_for_label }}"
                                                   value="{{ form.industry.value|default:'' }}"
                                                   class="form-input {% if form.industry.errors %}border-red-500{% endif %}"
                                                   placeholder="e.g. Technology, Finance, Education">
                                        </div>
                                        {% if form.industry.errors %}
                                        <p class="error-message">{{ form.industry.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Please specify -->
                                    <div id="employment-other-container" style="display: none;">
                                        <label for="{{ form.employment_other_details.id_for_label }}" class="block text-gray-700 font-medium mb-2">Please specify</label>
                                        <div class="relative">
                                            <textarea name="{{ form.employment_other_details.name }}"
                                                      id="{{ form.employment_other_details.id_for_label }}"
                                                      class="form-input {% if form.employment_other_details.errors %}border-red-500{% endif %}"
                                                      placeholder="Please provide more details about your employment status"
                                                      rows="3">{{ form.employment_other_details.value|default:'' }}</textarea>
                                        </div>
                                        {% if form.employment_other_details.errors %}
                                        <p class="error-message">{{ form.employment_other_details.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Areas of Interest Section -->
                            <div class="form-section">
                                <h3 class="section-title">Areas of Interest</h3>
                                <div class="space-y-4">
                                    <p class="text-gray-600 mb-2">Please select your areas of interest:</p>
                                    
                                    <!-- Networking/Peer Engagement -->
                                    <div class="flex items-center">
                                        <input type="checkbox" 
                                               name="{{ form.interest_networking.name }}" 
                                               id="{{ form.interest_networking.id_for_label }}"
                                               {% if form.interest_networking.value %}checked{% endif %}
                                               class="h-5 w-5 text-msu-blue rounded border-gray-300 focus:ring-msu-blue">
                                        <label for="{{ form.interest_networking.id_for_label }}" class="ml-3 block text-gray-700">1) Networking/Peer Engagement</label>
                                    </div>
                                    
                                    <!-- Academic & Mentorship -->
                                    <div class="flex items-center">
                                        <input type="checkbox" 
                                               name="{{ form.interest_academic.name }}" 
                                               id="{{ form.interest_academic.id_for_label }}"
                                               {% if form.interest_academic.value %}checked{% endif %}
                                               class="h-5 w-5 text-msu-blue rounded border-gray-300 focus:ring-msu-blue">
                                        <label for="{{ form.interest_academic.id_for_label }}" class="ml-3 block text-gray-700">2) Academic & Mentorship</label>
                                    </div>
                                    
                                    <!-- Career & Professional Development -->
                                    <div class="flex items-center">
                                        <input type="checkbox" 
                                               name="{{ form.interest_career.name }}" 
                                               id="{{ form.interest_career.id_for_label }}"
                                               {% if form.interest_career.value %}checked{% endif %}
                                               class="h-5 w-5 text-msu-blue rounded border-gray-300 focus:ring-msu-blue">
                                        <label for="{{ form.interest_career.id_for_label }}" class="ml-3 block text-gray-700">3) Career & Professional Development</label>
                                    </div>
                                    
                                    <!-- Giving Back -->
                                    <div class="flex items-center">
                                        <input type="checkbox" 
                                               name="{{ form.interest_giving_back.name }}" 
                                               id="{{ form.interest_giving_back.id_for_label }}"
                                               {% if form.interest_giving_back.value %}checked{% endif %}
                                               class="h-5 w-5 text-msu-blue rounded border-gray-300 focus:ring-msu-blue">
                                        <label for="{{ form.interest_giving_back.id_for_label }}" class="ml-3 block text-gray-700">4) Giving Back</label>
                                    </div>
                                    
                                    <!-- Stay Informed -->
                                    <div class="flex items-center">
                                        <input type="checkbox" 
                                               name="{{ form.interest_stay_informed.name }}" 
                                               id="{{ form.interest_stay_informed.id_for_label }}"
                                               {% if form.interest_stay_informed.value %}checked{% endif %}
                                               class="h-5 w-5 text-msu-blue rounded border-gray-300 focus:ring-msu-blue">
                                        <label for="{{ form.interest_stay_informed.id_for_label }}" class="ml-3 block text-gray-700">5) Stay Informed</label>
                                    </div>

                                    <!-- Other Interest -->
                                    <div class="flex items-center">
                                        <input type="checkbox" 
                                               name="{{ form.interest_other.name }}" 
                                               id="{{ form.interest_other.id_for_label }}"
                                               {% if form.interest_other.value %}checked{% endif %}
                                               class="h-5 w-5 text-msu-blue rounded border-gray-300 focus:ring-msu-blue">
                                        <label for="{{ form.interest_other.id_for_label }}" class="ml-3 block text-gray-700">6) Other (please specify)</label>
                                    </div>
                                    <div id="interest-other-container" style="display: none;">
                                        <label for="{{ form.interest_other_details.id_for_label }}" class="block text-gray-700 font-medium mb-2">Other interest details</label>
                                        <textarea 
                                            name="{{ form.interest_other_details.name }}"
                                            id="{{ form.interest_other_details.id_for_label }}"
                                            class="form-input {% if form.interest_other_details.errors %}border-red-500{% endif %}"
                                            rows="3"
                                            placeholder="Please specify your other interests">{{ form.interest_other_details.value|default:'' }}</textarea>
                                        {% if form.interest_other_details.errors %}
                                        <p class="error-message">{{ form.interest_other_details.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Data Protection Consent -->
                            <div class="form-section pt-4 border-t border-gray-100">
                                <div class="flex items-start">
                                    <div class="flex items-start mt-1">
                                        <div class="flex items-center h-5">
                                            <input type="checkbox" 
                                                   name="{{ form.data_protection_consent.name }}" 
                                                   id="{{ form.data_protection_consent.id_for_label }}"
                                                   class="h-4 w-4 text-msu-blue focus:ring-msu-blue border-gray-300 rounded {% if form.data_protection_consent.errors %}border-red-500{% endif %}"
                                                   {% if form.data_protection_consent.value %}checked{% endif %}
                                                   required>
                                        </div>
                                    </div>
                                    <div class="ml-3">
                                        <label for="{{ form.data_protection_consent.id_for_label }}" class="text-sm text-gray-700">
                                            I consent to the processing of my personal data in accordance with the 
                                            <a href="https://www.veritaszim.net/sites/veritas_d/files/SI%202024-155%20Cyber%20and%20Data%20Protection%20%28Licensing%20of%20Data%20Controllers%20and%20Appointment%20of%20Data%20Protection%20Officers%29%20Regulations%2C%202024.pdf" target="_blank" rel="noopener" class="text-msu-blue hover:underline">Data Protection Policy</a>.
                                        </label>
                                        {% if form.data_protection_consent.errors %}
                                        <p class="error-message">{{ form.data_protection_consent.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- Marketing Consent -->
                                <div class="flex items-start mt-4">
                                    <div class="flex items-start mt-1">
                                        <div class="flex items-center h-5">
                                            <input type="checkbox" 
                                                   name="marketing_consent" 
                                                   id="marketing_consent"
                                                   class="h-4 w-4 text-msu-blue focus:ring-msu-blue border-gray-300 rounded {% if form.marketing_consent.errors %}border-red-500{% endif %}"
                                                   {% if form.marketing_consent.value %}checked{% endif %}>
                                        </div>
                                    </div>
                                    <div class="ml-3">
                                        <label for="marketing_consent" class="text-sm text-gray-700">
                                            I would like to receive updates, newsletters, and information about alumni events.
                                        </label>
                                        {% if form.marketing_consent.errors %}
                                        <p class="error-message">{{ form.marketing_consent.errors.0 }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Submit Button -->
                            <div class="mt-8 pt-6 border-t border-gray-100">
                                <button type="submit" class="btn-primary transform transition-transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-msu-blue">
                                    <span class="flex items-center justify-center">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                        </svg>
                                        Complete Registration
                                    </span>
                                </button>
                                <p class="text-xs text-gray-500 mt-3 text-center">
                                    By submitting this form, you agree to our 
                                    <a href="{% url 'alumni:terms' %}" class="text-msu-blue hover:underline">Terms of Service</a> and 
                                    <a href="{% url 'alumni:privacy' %}" class="text-msu-blue hover:underline">Privacy Policy</a>.
                                </p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Information -->
            <div class="lg:w-1/3 space-y-6">
                <!-- Why Register Card -->
                <div class="info-card">
                    <h3>Why Register?</h3>
                    <ul class="space-y-3">
                        <li class="flex items-start">
                            <svg class="h-5 w-5 text-green-500 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            <span>Stay connected with your alma mater</span>
                        </li>
                        <li class="flex items-start">
                            <svg class="h-5 w-5 text-green-500 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            <span>Receive exclusive alumni news, opportunities, and events</span>
                        </li>
                        <li class="flex items-start">
                            <svg class="h-5 w-5 text-green-500 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            <span>Network with fellow graduates worldwide</span>
                        </li>
                        <li class="flex items-start">
                            <svg class="h-5 w-5 text-green-500 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            <span>Access mentorship, career, and professional development programs</span>
                        </li>
                        <li class="flex items-start">
                            <svg class="h-5 w-5 text-green-500 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            <span>Support and contribute to MSU’s legacy</span>
                        </li>
                    </ul>
                </div>
                
                <!-- Contact Card -->
                <div class="info-card">
                    <h3>Need Help?</h3>
                    <p>Our alumni support team is here to assist you with your registration.</p>
                    <div class="mt-4 space-y-2">
                        <p class="flex items-center text-gray-700">
                            <svg class="h-5 w-5 text-msu-blue mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                            </svg>
                            alumni@admin.msu.ac.zw
                        </p>
                        <p class="flex items-center text-gray-700">
                            <svg class="h-5 w-5 text-msu-blue mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" />
                            </svg>
                            +263 54-2260283 ext. 2036/2103
                        </p>
                    </div>
                </div>
                
                <!-- Quick Links Card -->
                <div class="info-card">
                    <h3>Quick Links</h3>
                    <ul class="space-y-3">
                        <li>
                            <a href="#" class="text-msu-blue hover:underline flex items-center">
                                <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                                Alumni Benefits
                            </a>
                        </li>
                        <li>
                            <a href="#" class="text-msu-blue hover:underline flex items-center">
                                <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                                Update Your Details
                            </a>
                        </li>
                        <li>
                            <a href="#" class="text-msu-blue hover:underline flex items-center">
                                <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                </svg>
                                Events Calendar
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block extra_js %}
{{ block.super }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/css/intlTelInput.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/js/intlTelInput.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="{% static 'js/alumni_registration.js' %}"></script>
{% endblock %}

<script>
    // Password strength checker
    function checkPasswordStrength(password) {
        const strongRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])/;
        const mediumRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])/;
        
        if (strongRegex.test(password)) {
            return 'strong';
        } else if (mediumRegex.test(password)) {
            return 'medium';
        } else {
            return 'weak';
        }
    }

    // Initialize form when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        const meter = document.getElementById('password-strength-meter');
        const text = document.getElementById('password-strength-text');
        
        // Check password length
        const passwordInput = document.getElementById('{{ form.password1.id_for_label }}');
        if (passwordInput) {
            passwordInput.addEventListener('input', function() {
                const password = passwordInput.value;
                let strength = 0;
                
                // Calculate strength
                if (password.length >= 8) strength++;
                if (password.length >= 12) strength++;
                if (password.match(/[a-z]+/)) strength++;
                if (password.match(/[A-Z]+/)) strength++;
                if (password.match(/[0-9]+/)) strength++;
                if (password.match(/[^A-Za-z0-9]+/)) strength++;
                
                // Update UI
                if (meter) {
                    if (password.length === 0) {
                        meter.className = 'w-full h-1.5 rounded bg-gray-200';
                        if (text) text.textContent = '';
                    } else if (strength <= 2) {
                        meter.className = 'w-full h-1.5 rounded bg-red-500';
                        if (text) {
                            text.textContent = 'Weak';
                            text.className = 'text-xs text-red-600 mt-1';
                        }
                    } else if (strength <= 4) {
                        meter.className = 'w-full h-1.5 rounded bg-yellow-500';
                        if (text) {
                            text.textContent = 'Moderate';
                            text.className = 'text-xs text-yellow-600 mt-1';
                        }
                    } else {
                        meter.className = 'w-full h-1.5 rounded bg-green-500';
                        if (text) {
                            text.textContent = 'Strong';
                            text.className = 'text-xs text-green-600 mt-1';
                        }
                    }
                }
            });
        }

    // Initialize form when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Form elements
        const form = document.querySelector('form');
        if (!form) return;
        
        // Helper function to show error message
        function showError(field, message) {
            field.classList.add('border-red-500');
            let errorElement = field.nextElementSibling;
            if (!errorElement || !errorElement.classList.contains('error-message')) {
                errorElement = document.createElement('p');
                errorElement.className = 'error-message text-red-500 text-sm mt-1';
                errorElement.textContent = message;
                field.parentNode.insertBefore(errorElement, field.nextSibling);
            }
            return errorElement;
        }
        
        // Helper function to clear error
        function clearError(field) {
            field.classList.remove('border-red-500');
            const errorElement = field.nextElementSibling;
            if (errorElement && errorElement.classList.contains('error-message')) {
                errorElement.remove();
            }
        }

        // Validate age >= 18
        function validateAge(field) {
            if (!field.value) return;
            const dob = new Date(field.value);
            const today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            const m = today.getMonth() - dob.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            if (age < 18) {
                showError(field, 'You must be at least 18 years old');
            } else {
                clearError(field);
            }
        }

        // Initialize Select2 for country dropdown
        const countrySelect = $('#{{ form.country.id_for_label }}');
        countrySelect.select2({
            theme: 'bootstrap-5',
            width: '100%',
            placeholder: 'Select a country',
            allowClear: true,
            dropdownParent: $('body')
        })

        // Initialize phone validation with intl-tel-input
        const phoneInput = document.getElementById('{{ form.mobile_number.id_for_label }}');
        let iti;
        if (phoneInput) {
            iti = window.intlTelInput(phoneInput, {
                separateDialCode: true,
                utilsScript: 'https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/js/utils.js'
            });

            phoneInput.addEventListener('input', () => clearError(phoneInput));

            phoneInput.addEventListener('blur', function() {
                if (phoneInput.value.trim()) {
                    if (!iti.isValidNumber()) {
                        showError(phoneInput, 'Enter a valid phone number');
                    } else {
                        clearError(phoneInput);
                    }
                }
            });

            form.addEventListener('submit', function() {
                if (iti && iti.isValidNumber()) {
                    phoneInput.value = iti.getNumber(); // sets full international number
                }
            });
        }

        // Initialize date picker for date of birth
        const dateOfBirthInput = document.getElementById('{{ form.date_of_birth.id_for_label }}');
        if (dateOfBirthInput) {
            // Initialize Flatpickr date picker
            flatpickr(dateOfBirthInput, {
                dateFormat: "Y-m-d",
                maxDate: new Date(),
                allowInput: true,
                disableMobile: true
            });

            // Also validate when user leaves the field
            dateOfBirthInput.addEventListener('blur', function() {
                validateAge(dateOfBirthInput);
            });
        }

        // Handle country change
        countrySelect.on('change', function() {
            const countryCode = $(this).val();
            const cityInput = $('#{{ form.city.id_for_label }}');
            
            if (countryCode) {
                cityInput.prop('disabled', false);
                cityInput.attr('placeholder', 'Enter your city or town');
                clearError(document.getElementById('{{ form.country.id_for_label }}'));
            } else {
                cityInput.prop('disabled', true);
                cityInput.val('');
            }
        });

        // Form validation
        const requiredFields = form.querySelectorAll('[required]');
        const emailInput = document.getElementById('{{ form.email.id_for_label }}');
        const confirmEmailInput = document.getElementById('{{ form.confirm_email.id_for_label }}');
        const passwordInput = document.getElementById('{{ form.password1.id_for_label }}');
        const confirmPasswordInput = document.getElementById('{{ form.password2.id_for_label }}');
        
        // Clear errors on input
        form.addEventListener('input', function(e) {
            const target = e.target;
            if (target.hasAttribute('required')) {
                clearError(target);
            }
        });
        
        // Password confirmation validation
        if (passwordInput && confirmPasswordInput) {
            const validatePasswordMatch = (passwordField, confirmField) => {
                if (passwordField.value !== confirmField.value) {
                    showError(confirmField, 'Passwords do not match');
                    return false;
                } else {
                    clearError(confirmField);
                    return true;
                }
            };
            
            passwordInput.addEventListener('input', () => validatePasswordMatch(passwordInput, confirmPasswordInput));
            confirmPasswordInput.addEventListener('input', () => validatePasswordMatch(passwordInput, confirmPasswordInput));
        }
        

        // Generate graduation years (1980 to current year + 5) - Client-side fallback
        const graduationYearSelect = document.getElementById('{{ form.graduation_year.id_for_label }}');
        if (graduationYearSelect && graduationYearSelect.options.length <= 1) {
            const currentYear = new Date().getFullYear();
            let options = '<option value="">Select Year</option>';
            
            for (let year = currentYear + 5; year >= 1980; year--) {
                const selected = '{{ form.graduation_year.value|default:"" }}' == year ? 'selected' : '';
                options += `<option value="${year}" ${selected}>${year}</option>`;
            }
            
            graduationYearSelect.innerHTML = options;
        }



            

            
            




            // Email confirmation validation
            if (emailInput && confirmEmailInput) {
                const validateEmailMatch = () => {
                    if (emailInput.value !== confirmEmailInput.value) {
                        confirmEmailInput.classList.add('border-red-500');
                        let errorMsg = confirmEmailInput.nextElementSibling;
                        if (!errorMsg || !errorMsg.classList.contains('error-message')) {
                            errorMsg = document.createElement('p');
                            errorMsg.className = 'error-message text-red-500 text-sm mt-1';
                            errorMsg.textContent = 'Email addresses do not match';
                            confirmEmailInput.parentNode.insertBefore(errorMsg, confirmEmailInput.nextSibling);
                        }
                        return false;
                    } else {
                        confirmEmailInput.classList.remove('border-red-500');
                        const errorMsg = confirmEmailInput.nextElementSibling;
                        if (errorMsg && errorMsg.classList.contains('error-message')) {
                            errorMsg.remove();
                        }
                        return true;
                    }
                };
                
                emailInput.addEventListener('input', validateEmailMatch);
                confirmEmailInput.addEventListener('input', validateEmailMatch);
            }
            


            // Initialize date picker
            const datePicker = flatpickr(".date-picker", {
                dateFormat: "Y-m-d",
                maxDate: new Date().fp_incr(0), // Today
                allowInput: true,
                disableMobile: true, // Better mobile experience
                onChange: function(selectedDates, dateStr, instance) {
                    const input = instance.input;
                    if (input) {
                        input.classList.remove('border-red-500');
                        const errorElement = input.nextElementSibling;
                        if (errorElement && errorElement.classList.contains('text-red-500')) {
                            errorElement.remove();
                        }
                    }
                }
            });

            // Form submission handler
            form.addEventListener('submit', function(e) {
                let isValid = true;
                let firstError = null;
                
                // Reset all error states
                form.querySelectorAll('.border-red-500').forEach(el => el.classList.remove('border-red-500'));
                form.querySelectorAll('.error-message').forEach(el => el.remove());
                
                // Validate required fields
                requiredFields.forEach(field => {
                    const shouldValidate = field.type !== 'checkbox' || field.checked;
                    const isEmpty = field.type === 'checkbox' ? !field.checked : !field.value.trim();
                    const parent = field.closest('.relative') || field.parentNode;
                    
                    if (shouldValidate && isEmpty) {
                        field.classList.add('border-red-500');
                        
                        // Add error message if it doesn't exist
                        let errorElement = field.nextElementSibling;
                        if (!errorElement || !errorElement.classList.contains('text-red-500')) {
                            errorElement = document.createElement('p');
                            errorElement.className = 'text-red-500 text-sm mt-1';
                            errorElement.textContent = 'This field is required';
                            
                            // Insert after the field or its container
                            if (field.type === 'checkbox') {
                                field.closest('.flex').parentNode.insertBefore(errorElement, field.closest('.flex').nextSibling);
                            } else {
                                field.parentNode.insertBefore(errorElement, field.nextSibling);
                            }
                        }
                        
                        // Track first error for scrolling
                        if (firstError === null) {
                            firstError = field;
                        }
                        isValid = false;
                    }
                });
                
// Validate email format
                const emailField = document.getElementById('{{ form.email.id_for_label }}');
                if (emailField && emailField.value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(emailField.value)) {
                        emailField.classList.add('border-red-500');
                        let errorElement = emailField.nextElementSibling;
                        if (!errorElement || !errorElement.classList.contains('text-red-500')) {
                            errorElement = document.createElement('p');
                            errorElement.className = 'text-red-500 text-sm mt-1';
                            errorElement.textContent = 'Please enter a valid email address';
                            emailField.parentNode.insertBefore(errorElement, emailField.nextSibling);
                        }
                        isValid = false;
                        if (!firstError) firstError = emailField;
                    }
                }
                
                // Validate first name format
                const firstNameField = document.getElementById('{{ form.first_name.id_for_label }}');
                if (firstNameField && firstNameField.value) {
                    const nameRegex = /^[a-zA-Z\s]+$/;
                    if (!nameRegex.test(firstNameField.value)) {
                        firstNameField.classList.add('border-red-500');
                        let errorElement = firstNameField.nextElementSibling;
                        if (!errorElement || !errorElement.classList.contains('text-red-500')) {
                            errorElement = document.createElement('p');
                            errorElement.className = 'text-red-500 text-sm mt-1';
                            errorElement.textContent = 'First name must contain only letters and spaces';
                            firstNameField.parentNode.insertBefore(errorElement, firstNameField.nextSibling);
                        }
                        isValid = false;
                        if (!firstError) firstError = firstNameField;
                    }
                }
                
// Validate last name format
                const lastNameField = document.getElementById('{{ form.last_name.id_for_label }}');
                if (lastNameField && lastNameField.value) {
                    const nameRegex = /^[a-zA-Z\s]+$/;
                    if (!nameRegex.test(lastNameField.value)) {
                        lastNameField.classList.add('border-red-500');
                        let errorElement = lastNameField.nextElementSibling;
                        if (!errorElement || !errorElement.classList.contains('text-red-500')) {
                            errorElement = document.createElement('p');
                            errorElement.className = 'text-red-500 text-sm mt-1';
                            errorElement.textContent = 'Last name must contain only letters and spaces';
                            lastNameField.parentNode.insertBefore(errorElement, lastNameField.nextSibling);
                        }
                        isValid = false;
                        if (!firstError) firstError = lastNameField;
                    }
                }
                
                // Validate email confirmation
                const confirmEmailInput = document.getElementById('{{ form.confirm_email.id_for_label }}');
                if (emailField && confirmEmailInput && emailField.value !== confirmEmailInput.value) {
                    confirmEmailInput.classList.add('border-red-500');
                    let errorMsg = confirmEmailInput.nextElementSibling;
                    if (!errorMsg || !errorMsg.classList.contains('error-message')) {
                        errorMsg = document.createElement('p');
                        errorMsg.className = 'error-message text-red-500 text-sm mt-1';
                        errorMsg.textContent = 'Email addresses do not match';
                        confirmEmailInput.parentNode.insertBefore(errorMsg, confirmEmailInput.nextSibling);
                    }
                    isValid = false;
                    if (!firstError) firstError = confirmEmailInput;
                }
                
                // Validate password match
                const passwordInput = document.getElementById('{{ form.password1.id_for_label }}');
                const confirmPasswordInput = document.getElementById('{{ form.password2.id_for_label }}');
                if (passwordInput && confirmPasswordInput && passwordInput.value !== confirmPasswordInput.value) {
                    confirmPasswordInput.classList.add('border-red-500');
                    let errorMsg = confirmPasswordInput.nextElementSibling;
                    if (!errorMsg || !errorMsg.classList.contains('error-message')) {
                        errorMsg = document.createElement('p');
                        errorMsg.className = 'error-message text-red-500 text-sm mt-1';
                        errorMsg.textContent = 'Passwords do not match';
                        confirmPasswordInput.parentNode.insertBefore(errorMsg, confirmPasswordInput.nextSibling);
                    }
                    isValid = false;
                    if (!firstError) firstError = confirmPasswordInput;
                }
                
                if (!isValid) {
                    e.preventDefault();
                    // Scroll to first error
                    if (firstError) {
                        firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            });
            
            // Gender change handler
            const genderSelect = document.getElementById('{{ form.gender.id_for_label }}');
            if (genderSelect) {
                function handleGenderChange() {
                    const maidenNameContainer = document.getElementById('maiden-name-container');
                    if (genderSelect.value === 'F') {
                        maidenNameContainer.style.display = 'block';
                    } else {
                        maidenNameContainer.style.display = 'none';
                    }
                }
                
                genderSelect.addEventListener('change', handleGenderChange);
                
                // Trigger on page load if already selected
                setTimeout(function() {
                    handleGenderChange();
                }, 100);
            }
            
            // Employment functionality moved to bottom of page
            
            // Remove error state when user starts typing
            form.querySelectorAll('input, select, textarea').forEach(field => {
                field.addEventListener('input', function() {
                    if (this.value.trim()) {
                        clearError(this);
                    }
                });
            });
        });
    });
</script>

{% block scripts %}
{{ block.super }}
<script src="{% static 'js/employment_fields.js' %}"></script>
<script src="{% static 'js/maiden_name.js' %}"></script>
<script src="{% static 'js/interest_other.js' %}"></script>
<script src="{% static 'js/remove_empty_select_options.js' %}"></script>
{% endblock %}
